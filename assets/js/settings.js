(()=>{"use strict";function e(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var t="function"==typeof Symbol&&Symbol.observable||"@@observable",a=function(){return Math.random().toString(36).substring(7).split("").join(".")},n={INIT:"@@redux/INIT"+a(),REPLACE:"@@redux/REPLACE"+a(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+a()}};function c(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const r="UPDATE_STATE",l="UPDATE_SETTINGS",o="UPDATE_REPORT",i={loading:!0,active_connections:{},automated_email_report:{},enable_schema:!0,schema:null},s={active_connections:{},automated_email_report:{},enable_schema:!0,schema:null},u=function a(r,l,o){var i;if("function"==typeof l&&"function"==typeof o||"function"==typeof o&&"function"==typeof arguments[3])throw new Error(e(0));if("function"==typeof l&&void 0===o&&(o=l,l=void 0),void 0!==o){if("function"!=typeof o)throw new Error(e(1));return o(a)(r,l)}if("function"!=typeof r)throw new Error(e(2));var s=r,u=l,m=[],d=m,p=!1;function g(){d===m&&(d=m.slice())}function E(){if(p)throw new Error(e(3));return u}function h(t){if("function"!=typeof t)throw new Error(e(4));if(p)throw new Error(e(5));var a=!0;return g(),d.push(t),function(){if(a){if(p)throw new Error(e(6));a=!1,g();var n=d.indexOf(t);d.splice(n,1),m=null}}}function f(t){if(!c(t))throw new Error(e(7));if(void 0===t.type)throw new Error(e(8));if(p)throw new Error(e(9));try{p=!0,u=s(u,t)}finally{p=!1}for(var a=m=d,n=0;n<a.length;n++)(0,a[n])();return t}function R(t){if("function"!=typeof t)throw new Error(e(10));s=t,f({type:n.REPLACE})}function y(){var a,n=h;return(a={subscribe:function(t){if("object"!=typeof t||null===t)throw new Error(e(11));function a(){t.next&&t.next(E())}return a(),{unsubscribe:n(a)}}})[t]=function(){return this},a}return f({type:n.INIT}),(i={dispatch:f,subscribe:h,getState:E,replaceReducer:R})[t]=y,i}(function(t){for(var a=Object.keys(t),c={},r=0;r<a.length;r++){var l=a[r];"function"==typeof t[l]&&(c[l]=t[l])}var o,i=Object.keys(c);try{!function(t){Object.keys(t).forEach((function(a){var c=t[a];if(void 0===c(void 0,{type:n.INIT}))throw new Error(e(12));if(void 0===c(void 0,{type:n.PROBE_UNKNOWN_ACTION()}))throw new Error(e(13))}))}(c)}catch(e){o=e}return function(t,a){if(void 0===t&&(t={}),o)throw o;for(var n=!1,r={},l=0;l<i.length;l++){var s=i[l],u=c[s],m=t[s],d=u(m,a);if(void 0===d)throw a&&a.type,new Error(e(14));r[s]=d,n=n||d!==m}return(n=n||i.length!==Object.keys(t).length)?r:t}}({state:(e=i,t)=>"UPDATE_STATE"===t.type?{...e,...t.payload}:e,settings:(e=s,t)=>{const{type:a,payload:n}=t;switch(a){case"UPDATE_SETTINGS":return{...e,...t.payload};case"UPDATE_CONNECTIONS":return{...e,active_connections:{...n}};case"UPDATE_REPORT":return{...e,...n};case"UPDATE_SCHEMA":return{...e,schema:n};case"ENABLE_SCHEMA":return{...e,enable_schema:n};default:return e}}})),m=u,d=()=>proofratings,{useState:p,useEffect:g}=React,E=({location_id:e})=>{const[t,a]=p(""),[n,c]=p(m.getState().settings),o="object"==typeof n?.active_connections?n.active_connections:{},i=Array.isArray(d()?.connections_approved)?d().connections_approved:[];g((()=>{const e=m.subscribe((()=>c(m.getState().settings)));return()=>e()}),[]);const s="overall"===e,E=(e,t,a)=>{if(s)return;const n="object"==typeof o[e]?o[e]:{};var c;o[e]=Object.assign(n,{[t]:a}),(c={type:"UPDATE_CONNECTIONS",payload:o}).type!==l&&u.dispatch({type:r,payload:{editing:!0}}),u.dispatch(c)},h=[];"object"==typeof d()?.review_sites&&Object.entries(d().review_sites).forEach((e=>{e[1].slug=e[0],e[1].approved=i.includes(e[0]),h.push(e[1])}));const f=m.getState().state?.reviews,R=h.filter((e=>!t.length||void 0!==e.name&&e.name.toLowerCase().match(new RegExp(t))));return React.createElement(React.Fragment,null,React.createElement("div",{className:"search-review-sites-wrapper"},React.createElement("div",{className:"left-column"},React.createElement("form",{className:"form-search-review-sites",style:{alignSelf:"flex-end"},onSubmit:e=>e.preventDefault()},React.createElement("input",{type:"text",placeholder:"Search...",onChange:e=>a(e.target.value)}),React.createElement("button",null))),React.createElement("div",{className:"intro-text"},React.createElement("h3",null,"Connect review sites"),!0===s&&React.createElement(React.Fragment,null,React.createElement("p",null,"When all locations is selected, you will not see site connections available."),React.createElement("p",null,"All locations is a collective of all your locations and the sites available will be the ones connected with each individual site. In order to access and edit connected sites, select individual locations.")),!1===s&&React.createElement("div",null,React.createElement("p",null,"Below is the current list of supported review sites to connect for your rating badges. During the initial setup of your account, we will connect the review sites your requested at sign up."),React.createElement("p",null,"If you would like to add additional sites, simply toggle on the review site and our support team will be notified to make the connection on the backend."),React.createElement("p",null,"Once connected, you can include the new review site in badges by accessing your Rating Badges tab."),React.createElement("p",null,"You can edit the click-through URL in this area if you would like your website visitors to visit a different link when they click the pertaining badge.")))),React.createElement("div",{className:"gap-50"}),React.createElement("table",{className:"table-review-sites "+(s?"table-location-overall":"")},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null),React.createElement("th",{className:"column-review-sites"},"Review Site"),React.createElement("th",null,"Rating"),React.createElement("th",null,"# of Reviews"),React.createElement("th",{className:"column-click-through-url"},"Click-through URL"))),React.createElement("tbody",null,R.map((e=>React.createElement("tr",{key:e.slug},(e=>{const t=e.slug,a="object"==typeof o[t]?o[t]:{},n=Object.assign(e,{selected:!1,url:""},a);return s&&(n.click_through_url=""),React.createElement(React.Fragment,null,React.createElement("td",null,React.createElement("label",{className:"label-switch-checkbox"},React.createElement("input",{className:"checkbox-switch",type:"checkbox",onChange:()=>(e=>{const t="object"==typeof o[e]?o[e]:{},a=void 0===t.selected||!1===t.selected;E(e,"selected",a)})(t),defaultChecked:n.selected}),React.createElement("span",null,"Off"),React.createElement("span",null,"On"))),React.createElement("td",{className:"review-site-logo"},React.createElement("img",{src:n.logo,alt:n.name})),!0===e.selected&&!1===e.approved?React.createElement("td",{className:"message-pending-connections",colSpan:4},"We are working on you connection and notify you when complete."):(()=>{const e=Object.assign({rating:0,reviews:0},f?.[t]);return!0===n.approved?React.createElement(React.Fragment,null,React.createElement("td",{className:"bold"},parseFloat(e.rating).toFixed(1)),React.createElement("td",{className:"bold"},e.reviews),React.createElement("td",{className:"click-through-url"},React.createElement("input",{type:"text",defaultValue:n.click_through_url,onInput:e=>E(t,"click_through_url",e.target.value)}),(e=>{try{return Boolean(new URL(e))}catch(e){return!1}})(n.click_through_url)?React.createElement("a",{className:"fa-solid fa-up-right-from-square",href:n.click_through_url,target:"_blank"}):"")):React.createElement("td",{colSpan:4})})())})(e)))))))},{useState:h,useEffect:f}=React,R=()=>{const[e,t]=h(""),[a,n]=h(m.getState().settings);f((()=>{const e=m.subscribe((()=>n(m.getState().settings)));return()=>e()}),[]);const c=Object.assign({active:!1,emails:[]},a?.automated_email_report),r=Object.assign({},a?.agency_settings),i=(e,t)=>{r[e]=t,m.dispatch({type:o,payload:{agency_settings:r}})};return React.createElement(React.Fragment,null,React.createElement("h2",{className:"section-title-large"},"Email Reporting"),React.createElement("div",{className:"email-reporting-wrap"},React.createElement("table",{className:"form-table"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",{scope:"row"},"Automated email report"),React.createElement("td",null,React.createElement("input",{onClick:()=>(c.active=!c?.active,void m.dispatch({type:o,payload:{automated_email_report:c}})),defaultChecked:c.active,type:"checkbox",className:"checkbox-switch checkbox-yesno"}))),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Email addresses"),React.createElement("td",null,React.createElement("input",{onKeyDown:a=>{if(13===a.keyCode)return!1===/\S+@\S+\.\S+/.test(e)?(alert("Please enter email address and hit enter."),!1):(c.emails.push(e),t(""),void m.dispatch({type:l,payload:{automated_email_report:c}}))},onInput:e=>t(e.target.value),value:e,type:"email"}),React.createElement("p",{style:{fontStyle:"italic",fontSize:13,marginTop:0}},"Type email and hit enter"),React.createElement("ul",{id:"reporting-email-addresses"},c.emails.map(((e,t)=>React.createElement("li",{key:t},React.createElement("span",{onClick:()=>(e=>{c.emails.splice(e,1),m.dispatch({type:o,payload:{automated_email_report:c}})})(t),className:"remove dashicons dashicons-dismiss"})," ",e)))))))),React.createElement("div",{className:"intro-text",style:{maxWidth:400}},React.createElement("h3",null,"Receive monthly data reports"),React.createElement("p",null,"Add emails to receive reports at the end of the month showing your rating badge analytics."))),!0===Boolean(d()?.agency)&&React.createElement(React.Fragment,null,React.createElement("h2",{className:"section-title-large"},"Settings for agency"),React.createElement("table",{className:"form-table"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",{scope:"row"},"Sender name"),React.createElement("td",null,React.createElement("input",{onInput:e=>i("sender_name",e.target.value),type:"text",defaultValue:r?.sender_name}))),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Sender email"),React.createElement("td",null,React.createElement("input",{onInput:e=>i("sender_email",e.target.value),type:"email",defaultValue:r?.sender_email}))),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Reply to email"),React.createElement("td",null,React.createElement("input",{onInput:e=>i("reply_to_email",e.target.value),type:"email",defaultValue:r?.reply_to_email}))),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Email logo URL"),React.createElement("td",null,React.createElement("input",{onInput:e=>i("email_logo",e.target.value),type:"url",defaultValue:r?.email_logo}))),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Email logo URL - Dark"),React.createElement("td",null,React.createElement("input",{onInput:e=>i("email_logo_dark",e.target.value),type:"url",defaultValue:r?.email_logo_dark})))))))},{useState:y,useEffect:v}=React,b=()=>{const[e,t]=y(m.getState().settings);v((()=>{const e=m.subscribe((()=>t(m.getState().settings)));return()=>e()}),[]),console.log(e);const a=e?.enable_schema;return React.createElement(React.Fragment,null,React.createElement("h2",{className:"section-title-large",style:{marginBottom:20}},"Structured data"),React.createElement("div",{className:"schema-wrapper"},React.createElement("div",{className:"left-column"},React.createElement("label",{className:"label-switch-checkbox",style:{marginBottom:15}},React.createElement("input",{className:"checkbox-switch",type:"checkbox",onChange:e=>m.dispatch({type:"ENABLE_SCHEMA",payload:!a}),defaultChecked:a}),React.createElement("span",null,"Disable Schema Markup"),React.createElement("span",null,"Enable Schema Markup")),React.createElement("textarea",{defaultValue:e?.schema,onInput:e=>m.dispatch({type:"UPDATE_SCHEMA",payload:e.target.value})}),React.createElement("p",{className:"description"},"Add the script block below to the head section of your html.")),React.createElement("div",null,React.createElement("div",{style:{marginBottom:33}}),React.createElement("div",{className:"intro-text"},React.createElement("h3",null,"Add star ratings to search results"),React.createElement("p",null,"Now that you display your rating badges on your website, you're able to gain your overall rating in search results.")))))},{useEffect:_,useState:w}=React,N=()=>{const[e,t]=w(m.getState().state);if(_((()=>{Array.isArray(proofratings.locations)||(proofratings.locations=[]);const e=m.subscribe((()=>t({...m.getState().state}))),a=void 0!==proofratings.locations[0]?proofratings.locations[0]:{location_id:"global"};return m.dispatch({type:r,payload:{location_id:a.location_id}}),()=>e()}),[]),_((()=>{e?.location_id&&(m.dispatch({type:r,payload:{loading:!0}}),jQuery.post(proofratings.ajaxurl,{action:"get_proofratings_location_settings",location_id:e.location_id},(function(e){if(console.log(e.settings),0==e?.success)return m.dispatch({type:r,payload:{error:!0,loading:!1}});m.dispatch({type:l,payload:e.settings}),m.dispatch({type:r,payload:{error:!1,loading:!1,reviews:e.reviews}})})).fail((function(){return t({...e,error:!0,loading:!1})})))}),[e.location_id]),!0===e.loading)return React.createElement("div",{className:"proofraing-progress-msg"},"Loading...");if(!0===e.error)return React.createElement("div",{className:"proofraing-progress-msg"},"Failed to retrive this location.");const a={connections:"Site Connections",report:"Monthly Report",schema:"Schema"},n=e?.settings_tab||"connections";return React.createElement(React.Fragment,null,React.createElement("header",{className:"proofratins-header"},React.createElement("a",{className:"btn-back-main-menu",href:"/wp-admin/admin.php?page=proofratings"},React.createElement("i",{className:"icon-back fa-solid fa-angle-left"})," Back to Main Menu"),React.createElement("h1",{className:"title"},"Settings"),!Boolean(proofratings?.global)&&(Array.isArray(proofratings.locations)||(proofratings.locations=[]),React.createElement("div",{className:"location-dropdown"},React.createElement("label",null,"Location"),React.createElement("select",{disabled:e.editing,className:"location-select",defaultValue:e?.location_id,onChange:e=>{return t=e.target.value,void m.dispatch({type:r,payload:{location_id:t}});var t}},proofratings.locations.map((e=>React.createElement("option",{key:e.location_id,value:e.location_id},e.name)))),e.editing&&React.createElement("p",{style:{marginTop:3}},"You need to save the changes or cancel before change location."))),React.createElement("div",{className:"rating-badges-navtab"},Object.keys(a).map((e=>{const t=n===e?"active":"";return React.createElement("a",{key:e,href:"#",onClick:t=>((e,t)=>{t.preventDefault(),m.dispatch({type:r,payload:{settings_tab:e}})})(e,t),className:t},a[e])})))),"connections"===n&&React.createElement(E,{location_id:e.location_id}),"report"===n&&React.createElement(R,null),"schema"===n&&React.createElement(b,null),React.createElement("div",{className:"form-footer"},React.createElement("button",{className:"button button-primary btn-save",onClick:()=>{if(e.saving)return;const t=Object.assign({action:"save_proofratings_location_settings",location_id:e.location_id},m.getState().settings);m.dispatch({type:r,payload:{saving:!0}}),t.action="save_proofratings_location_settings",jQuery.post(proofratings.ajaxurl,t,(e=>{console.log("After Saved",e.data),m.dispatch({type:r,payload:{editing:!1,saving:!1}})})).fail((()=>{m.dispatch({type:r,payload:{saving:!1}}),alert("Something went wrong")}))}},e.saving?"Saving...":"SAVE CHANGES"),React.createElement("a",{className:"btn-cancel",onClick:e=>{e.preventDefault(),m.dispatch({type:r,payload:{editing:!1}})},href:"#"},"CANCEL")))},S=document.getElementById("proofratings-settings-root");S&&ReactDOM.render(React.createElement(N,null),S)})();